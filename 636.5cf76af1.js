"use strict";(self.webpackChunkkafka_ui=self.webpackChunkkafka_ui||[]).push([[636],{90636:(e,r,i)=>{i.r(r),i.d(r,{ManagePermissions:()=>m,ManagePermissionsModal:()=>T,default:()=>y});var a=i(42695),s=i(85893),o=i(93264),n=i(76621),c=i(64517),t=i(3654),p=i(50834),l=i(74359),u=i(82774),d=i(87892);const m=({hideModal:e,onSave:r,kafkaName:i,selectedAccountId:a,acls:o,topicNames:n,consumerGroupIds:c,title:t,variant:p})=>(0,s.jsx)(T,{topicNames:n,consumerGroupIds:c,acls:o,resourceOperations:void 0,hideModal:e,selectedAccountId:a,onSave:r,kafkaName:i,variant:p,title:t}),T=({hideModal:e,kafkaName:r,acls:i,topicNames:m,consumerGroupIds:T})=>{const{kafka:y}=(0,c.S)()||{},A=(0,p.useAuth)(),[R,E]=(0,o.useState)(void 0),[v,f]=(0,o.useState)((i||[]).filter((e=>R&&R&&e.principal===`${R}`||"*"===e.principal))),[P,L]=(0,o.useState)(),I=(0,o.useCallback)((()=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){f((i||[]).filter((e=>R&&R&&e.principal===`${R}`||"*"===e.principal)))}))),[i,R]);(0,o.useEffect)((()=>{I()}),[i,I,R]);const k=(0,p.usePrincipals)(),{addAlert:N}=(0,p.useAlert)()||{addAlert:()=>{}},C=(0,o.useContext)(t.E),g=(0,n.qK)(C);(0,o.useEffect)((()=>{(0,a.__awaiter)(void 0,void 0,void 0,(function*(){const e=yield null==A?void 0:A.getUsername();L(e)}))}),[A]);const O=k.getAllPrincipals().filter((e=>e.id!==P&&e.id!==(null==y?void 0:y.owner))).map((e=>({displayName:e.displayName||"",id:e.id||"",principalType:e.principalType||u.PrincipalType.UserAccount})));return(0,s.jsx)(u.ManageKafkaPermissions,{accounts:O,onCancel:e,kafkaName:r||"",onSave:r=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){r.map((e=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){switch(e.type){case"manage-access":yield g.addPermission({resourceName:"kafka-cluster",resourceType:"CLUSTER",patternType:"LITERAL",operation:"ALTER",permission:"ALLOW",principal:`User:${R}`});break;case"manual":yield g.addPermission({resourceName:e.resourceName?e.resourceName:"",resourceType:(0,d.ED)(e.resourceType),patternType:"Is"==e.resourcePrefix?"LITERAL":"PREFIXED",operation:(0,d.m1)(e.resourceOperation),permission:"allow"==e.resourcePermission?"ALLOW":"DENY",principal:`User:${R}`});break;case"produce-topic":yield g.addPermission({resourceName:e.resourceNameValue||"",resourceType:"TOPIC",patternType:"Is"==e.prefixRuleValue?"LITERAL":"PREFIXED",operation:"WRITE",permission:"ALLOW",principal:`User:${R}`}),yield g.addPermission({resourceName:e.resourceNameValue||"",resourceType:"TOPIC",patternType:"Is"==e.prefixRuleValue?"LITERAL":"PREFIXED",operation:"CREATE",permission:"ALLOW",principal:`User:${R}`}),yield g.addPermission({resourceName:e.resourceNameValue||"",resourceType:"TOPIC",patternType:"Is"==e.prefixRuleValue?"LITERAL":"PREFIXED",operation:"DESCRIBE",permission:"ALLOW",principal:`User:${R}`});break;case"consume-topic":yield g.addPermission({resourceName:e.topicResourceName||"",resourceType:"TOPIC",patternType:"Is"==e.topicResourcePrefixRule?"LITERAL":"PREFIXED",operation:"READ",permission:"ALLOW",principal:`User:${R}`}),yield g.addPermission({resourceName:e.topicResourceName||"",resourceType:"TOPIC",patternType:"Is"==e.topicResourcePrefixRule?"LITERAL":"PREFIXED",operation:"DESCRIBE",permission:"ALLOW",principal:`User:${R}`}),yield g.addPermission({resourceName:e.consumerResourceName||"",resourceType:"GROUP",patternType:"Is"==e.consumerResourcePrefixRule?"LITERAL":"PREFIXED",operation:"READ",permission:"ALLOW",principal:`User:${R}`})}})))),e()})),existingAcls:v,onRemoveAcls:e=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){yield g.deletePermission({resourceName:v[e].resourceName,patternType:(0,n.L2)(v[e].patternType,l.AclPatternTypeFilter),permissionType:(0,n.L2)(v[e].permission,l.AclPermissionTypeFilter),resourceType:(0,n.L2)(v[e].resourceType,l.AclResourceTypeFilter),operation:(0,n.L2)(v[e].operation,l.AclOperationFilter),principal:`User:${R}`}).then((()=>(e=>{f((v||[]).filter(((r,i)=>i!=e)))})(e))).catch((e=>N({variant:p.AlertVariant.danger,title:e.response.data.reason})))})),selectedAccount:R,onChangeSelectedAccount:E,topicNameOptions:e=>m.filter((r=>r.includes(e))),consumerGroupNameOptions:e=>T.filter((r=>r.includes(e)))})},y=m},87892:(e,r,i)=>{i.d(r,{ED:()=>n,m1:()=>c,ss:()=>o});var a=i(74359),s=i(73866);const o=e=>{switch(e){case a.AclResourceType.Group:return"Consumer group";case a.AclResourceType.Topic:return"Topic";case a.AclResourceType.Cluster:return"Kafka instance";case a.AclResourceType.TransactionalId:return"Transactional ID";default:return(0,s.sentenceCase)(e)}},n=e=>{switch(e){case"consumer-group":return a.AclResourceType.Group;case"kafka-instance":return a.AclResourceType.Cluster;case"topic":return a.AclResourceType.Topic;default:return a.AclResourceType.TransactionalId}},c=e=>{switch(e){case"All":return"ALL";case"Alter":return"ALTER";case"Alter configs":return"ALTER_CONFIGS";case"Create":return"CREATE";case"Delete":return"DELETE";case"Describe":return"DESCRIBE";case"Describe configs":return"DESCRIBE_CONFIGS";case"Read":return"READ";default:return"WRITE"}}},76621:(e,r,i)=>{i.d(r,{L2:()=>t,qK:()=>p});var a=i(42695),s=i(93264),o=i(74359),n=i(9132),c=i.n(n);const t=(e,r)=>{const[,i]=Object.entries(r).find((([,r])=>r===e.toString()))||[];return i},p=e=>{const r=(0,s.useCallback)(((r,i,s)=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){const a=yield null==e?void 0:e.getToken(),n=new o.AclsApi(new o.Configuration({accessToken:a,basePath:null==e?void 0:e.basePath})),c=yield n.getAcls(r.resourceType,r.resourceName,r.patternType,r.principal,r.operation,r.permissionType,s,i);return l(c)}))),[e]),i=(0,s.useCallback)((r=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){const i=yield null==e?void 0:e.getToken(),a=new o.AclsApi(new o.Configuration({accessToken:i,basePath:null==e?void 0:e.basePath}));yield a.createAcl(r)}))),[e]),n=(0,s.useCallback)((r=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){const i=yield null==e?void 0:e.getToken(),a=new o.AclsApi(new o.Configuration({accessToken:i,basePath:null==e?void 0:e.basePath}));yield a.deleteAcls(r.resourceType,r.resourceName,r.patternType,r.principal,r.operation,r.permissionType)}))),[e]),c=(0,s.useCallback)((()=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){const r=yield null==e?void 0:e.getToken();return new o.AclsApi(new o.Configuration({accessToken:r,basePath:null==e?void 0:e.basePath})).getAclResourceOperations().then((e=>e.data))}))),[e]);return(0,s.useMemo)((()=>({getPermissions:r,addPermission:i,deletePermission:n,getResourceOperations:c})),[r,i,n,c])},l=e=>{var r;return{total:e.data.total,size:e.data.size,page:e.data.page,items:null===(r=e.data.items)||void 0===r?void 0:r.map((e=>Object.assign(Object.assign({},e),{principal:e.principal.substring(5),toString:()=>`${e.principal} ${e.permission} ${e.operation} ${e.patternType} ${e.resourceType} ${e.resourceName}`,hash:()=>c()(e)}))).sort(((e,r)=>e.principal!==r.principal?e.principal.localeCompare(r.principal):e.resourceType!==r.resourceType?e.resourceType.localeCompare(r.resourceType):e.resourceName!==r.resourceName?e.resourceName.localeCompare(r.resourceName):e.permission!==r.permission?"DENY"===e.permission?-1:1:e.operation!==r.operation?e.operation.localeCompare(r.operation):0))}}}}]);
//# sourceMappingURL=636.5cf76af1.js.map